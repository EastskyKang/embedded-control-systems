; This configuration file is for the MPC5554 Derivative (with no external memory)

; Initialize MSR
writereg	MSR 0x02000200

; This script initializes the MPC5554 for internal flash at 0x0.
; The setup maps virtual addresses to physical addresses.
; External Memory is mapped at 0x2000_0000
; 

; MMU accesses must go through the MMU Assist Registers (MAS0-MAS3)
; then copied into the TLB with the TLBWE instruction

; Setup MMU for BAM in flash
; Base address = 0x1130_0000
; TLB15, 1 MByte Memory Space, Guarded, Don't Cache, All Access
writereg MAS0 0x100F0000 ; MAS0
writereg MAS1 0xC0000500 ; MAS1
writereg MAS2 0x1130000A ; MAS2
writereg MAS3 0x1130003F ; MAS3
; execute tlbwe
execute_tlbwe

; Setup MMU for Periph B Modules
; Base address = 0xFFF0_0000
; TLB0, 1 MByte Memory Space, Guarded, Don't Cache, All Access
writereg MAS0 0x10000000 ; MAS0
writereg MAS1 0xC0000500 ; MAS1
writereg MAS2 0xFFF0000A ; MAS2
writereg MAS3 0xFFF0003F ; MAS3
; execute tlbwe
execute_tlbwe

; Set up MMU for Internal SRAM
; Base address = 0x4000_0000
; TLB3, 256 KByte Memory Space, Not Guarded, Don't Cache, All Access
writereg MAS0 0x10030000 ; MAS0
writereg MAS1 0xC0000400 ; MAS1
writereg MAS2 0x40000008 ; MAS2
writereg MAS3 0x4000003F ; MAS3
; execute tlbwe
execute_tlbwe


; Set up MMU for Periph A Modules
; Base address = 0xC3F0_0000
; TLB4, 1 MByte Memory Space, Not Guarded, Don't Cache, All Access
writereg MAS0 0x10040000 ; MAS0
writereg MAS1 0xC0000500 ; MAS1
writereg MAS2 0xC3F00008 ; MAS2
writereg MAS3 0xC3F0003F ; MAS3
; execute tlbwe
execute_tlbwe


; Set up MMU for Internal Flash
; Base address = 0x0000_0000
; TLB1, 16 MByte Memory Space, Not Guarded, Cachable, All Access
writereg MAS0 0x10010000 ; MAS0
writereg MAS1 0xC0000700 ; MAS1
writereg MAS2 0x00000000 ; MAS2
writereg MAS3 0x0000003F ; MAS3
; execute tlbwe
execute_tlbwe

; Set up MMU for External Memory
; Base address = 0x2000_0000
; TLB2, 16 MByte Memory Space, Not Guarded, Cachable, All Access
writereg MAS0 0x10020000 ; MAS0
writereg MAS1 0xC0000700 ; MAS1
writereg MAS2 0x20000000 ; MAS2
writereg MAS3 0x2000003F ; MAS3
; execute tlbwe
execute_tlbwe

; Set up MMU for External Memory - SRAM
; Base address = 0x3FF0_0000
; TLB5, 4 MByte Memory Space, Not Guarded, Cachable, All Access
writereg MAS0 0x10050000 ; MAS0
writereg MAS1 0xC0000600 ; MAS1
writereg MAS2 0x3ff00000 ; MAS2
writereg MAS3 0x3ff0003F ; MAS3
; execute tlbwe
execute_tlbwe

; write all bytes in the L2 cache with an access size of 8, 
; so following read/write that can use 4 (or 2 or 1) without generating an error.
; the mapping here corresponds to the location used in 
; the linker command file by the Wizard generated projects/examples
fastfillmem 0x40000000 8192 8

; CLKOUT
; PCR 229
writemem.w 0xc3f9020a 0x02c0

